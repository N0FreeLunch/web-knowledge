## 커넥션을 이해해야 하는 이유
- 웹 사이트의 성능에 큰 영향을 주는 요소 중 하나에 관한 이해를 할 수 있기 때문

## HTTP/1.x의 커넥션 종류
- 단기 커넥션
- 영속적인 커넥션
- HTTP 파이프라이닝

## 초기 HTTP 모델
- HTTP 프로토콜은 주로 TCP 전송프로토콜을 이용한다.
- 요청을 전송할 때 마다 TCP 커넥션을 만들어 통신을 했다.
- 응답을 보내면 TCP 커넥션이 닫히는 방식이었다.
- 1 요청에 1 커넥션이 필요했다.

### 초기 모델의 단점
- TCP 통신을 열고 닫는 것이 많은 자원을 소모함. 지연시간 발생, 서버 리소스 사용 등등
- 현대 웹 페이지는 기본적으로 여러 요청을 요구한다. HTML DOC과 그 안에 적힌 CSS, JS, IMG 등을 동일 서버에 추가적으로 요구할 때가 많아 비효율적이다.

## HTTP/1.1 에서 추가된 기능
### 영속적인 커넥션
- 하나의 커넥션 위에서 연속적인 커넥션을 처리하도록 한다. 연달은 요청을 처리하기 때문에 새 요청을 처리하기 위해 새 연결을 열 필요가 없다.

### HTTP 파이프라이닝
- 요청을 보낸 후, 응답을 기다리지 않고 새로운 요청을 연속해서 보낼 수 있다.

## 커넥션 모델 비교
- short-lived connection : 커넥션 연결 - 요청A - 응답A - 커넥션 종료 - 커넥션 연결 - 요청B - 응답B - 커넥션 종료 - 커넥션 연결 - 요청C - 응답C - 커넥션 종료
- persistent connection : 커넥션 연결 - 요청A - 응답A - 요청B - 응답B - 요청C - 응답C - 커넥션 종료
- HTTP pipeling : 커넥션 연결 - 요청A - 요청B - 요청C - 응답A - 응답B - 응답C - 커넥션 종료

## 단기 커넥션 (short-lived connectio)
- HTTP/1.0의 기본 커넥션은 단기 커넥션
- 하나의 HTTP 요청은 서로 독립적인 커넥션 위에서 실행 된다.
- 통신 프로토콜을 주고 받기 전에 물리적인 연결을 위한 채널이 만들어져야 하는데 이를 핸드셰이크라고 한다.
- HTTP 통신을 이루기 위해서는 메시지를 주고 받을 수 있는 채널이 만들어져야 하고 이 채널을 만드는 일반적인 방법은 TCP 연결이다. 이 연결 과정을 헨드셰이크라고 부른다.
- TCP 헨드셰이크는 직렬화 되므로 하나의 TCP 연결이 끝난 후에 다음 TCP 요청이 이뤄질 수 있다.
- TCP 헨드셰이크는 채널을 만드는 과정이므로 채널을 만드는데 시간이 든다. 채널을 만들기 위한 과정을 예열이라고 하고 예열작업이 완료되면 이 커넥션 위에서 통신을 할 수 있다.
- 지속적인 연결의 경우 하나의 TCP 커넥션 위에서 통신을 하는 것으로 송수신원이 동일한 경우이다.
- 지속적인 연결의 경우 기존 커넥션 정보를 활용하기 때문에 예열 작업이 필요 없으므로 TCP 연결이 더 빠르게 이뤄질 수 있다.
- 지속적인 연결은 다음 통신을 위해 기존 연결 정보를 최대한 활용하는 방식을 사용하므로 통신에 드는 예열 작업이 필요 없으므로 빠른 통신이 가능하다.
- 단기 커넥션은 한 쌍의 요청과 응답에 하나의 TCP의 커넥션을 사용하므로 통신을 하기 위해서는 매번 핸드셰이크 과정을 거쳐야 하므로 예열 시간이 든다. 따라서 효율이 떨어지고 예열되지 않은 새로운 연결을 통해 지속적으로 전송하여 성능이 최적 상태보다 저하된다.
- 단기 커넥션은 HTTP/1.0에서 사용된 기본 모델이다.
- HTTP/1.1에서는 지속적인 연결을 하기 때문에 통신할 때마다 커넥션을 다시 맺어주는 단기 커넥션 모델은 Connection 헤더가 close 값으로 설정되어 전송된 경우 사용하도록 규정되어 있다.
- 통신을 할 때 Connection 헤더는 커넥션을 어떤 방식으로 할지를 결정한다. 높은 버전의 HTTP 프로토콜을 사용한다면 커넥션 헤더를 통해서 낮은 버전의 커넥션 특징을 활용할 수 있게 하기 위해서 커넥션 헤더의 프로토콜을 지원하며 낮은 버전의 HTTP/1.0 버전의 프로토콜을 사용한다면 커넥션헤더 프로토콜이 정의되지 않았으므로 헤더가 존재하지 않는다.


## Reference
- https://developer.mozilla.org/ko/docs/Web/HTTP/Connection_management_in_HTTP_1.x




